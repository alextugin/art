(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{166:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(117),n(120),n(30),n(187);var o=n(162),r=function(e,t){void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),o.cb.call(this),this.visible=!1,this.domElement=t;var n=new l;this.add(n);var r=new c;this.add(r);var h=this;K("camera",e),K("object",void 0),K("enabled",!0),K("axis",null),K("mode","translate"),K("translationSnap",null),K("rotationSnap",null),K("scaleSnap",null),K("space","world"),K("size",1),K("dragging",!1),K("showX",!0),K("showY",!0),K("showZ",!0);var d={type:"change"},w={type:"mouseDown"},m={type:"mouseUp",mode:h.mode},y={type:"objectChange"},v=new o.ub;function S(object,e,t){for(var n=e.intersectObject(object,!0),i=0;i<n.length;i++)if(n[i].object.visible||t)return n[i];return!1}var M=new o.Lb,f=new o.Lb,x=new o.nb,P={X:new o.Lb(1,0,0),Y:new o.Lb(0,1,0),Z:new o.Lb(0,0,1)},X=new o.Lb,Y=new o.Lb,Z=new o.Lb,E=new o.Lb,L=new o.Lb,I=new o.Lb,D=0,Q=new o.Lb,z=new o.nb,j=new o.Lb,T=new o.Lb,A=new o.nb,k=new o.nb,W=new o.Lb,F=new o.Lb,O=new o.nb,C=new o.Lb,R=new o.Lb,G=new o.nb,_=new o.nb,H=new o.Lb,U=new o.Lb,J=new o.Lb,N=new o.nb,B=new o.Lb;function K(e,t){var o=t;Object.defineProperty(h,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,r[e]=t,n[e]=t,h.dispatchEvent({type:e+"-changed",value:t}),h.dispatchEvent(d))}}),h[e]=t,r[e]=t,n[e]=t}function V(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};var n=e.changedTouches?e.changedTouches[0]:e,rect=t.getBoundingClientRect();return{x:(n.clientX-rect.left)/rect.width*2-1,y:-(n.clientY-rect.top)/rect.height*2+1,button:e.button}}function $(e){h.enabled&&h.pointerHover(V(e))}function ee(e){h.enabled&&(document.addEventListener("mousemove",te,!1),h.pointerHover(V(e)),h.pointerDown(V(e)))}function te(e){h.enabled&&h.pointerMove(V(e))}function ne(e){h.enabled&&(document.removeEventListener("mousemove",te,!1),h.pointerUp(V(e)))}K("worldPosition",R),K("worldPositionStart",F),K("worldQuaternion",G),K("worldQuaternionStart",O),K("cameraPosition",Q),K("cameraQuaternion",z),K("pointStart",X),K("pointEnd",Y),K("rotationAxis",E),K("rotationAngle",D),K("eye",U),t.addEventListener("mousedown",ee,!1),t.addEventListener("touchstart",ee,!1),t.addEventListener("mousemove",$,!1),t.addEventListener("touchmove",$,!1),t.addEventListener("touchmove",te,!1),document.addEventListener("mouseup",ne,!1),t.addEventListener("touchend",ne,!1),t.addEventListener("touchcancel",ne,!1),t.addEventListener("touchleave",ne,!1),this.dispose=function(){t.removeEventListener("mousedown",ee),t.removeEventListener("touchstart",ee),t.removeEventListener("mousemove",$),document.removeEventListener("mousemove",te),t.removeEventListener("touchmove",$),t.removeEventListener("touchmove",te),document.removeEventListener("mouseup",ne),t.removeEventListener("touchend",ne),t.removeEventListener("touchcancel",ne),t.removeEventListener("touchleave",ne),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(object){return this.object=object,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(T,A,W),this.object.matrixWorld.decompose(R,G,H),k.copy(A).inverse(),_.copy(G).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(Q,z,j),U.copy(Q).sub(R).normalize(),o.cb.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){v.setFromCamera(e,this.camera);var t=S(n.picker[this.mode],v);this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){v.setFromCamera(e,this.camera);var t=S(r,v,!0);if(t){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var o=this.rotationSnap;"X"===this.axis&&o&&(this.object.rotation.x=Math.round(this.object.rotation.x/o)*o),"Y"===this.axis&&o&&(this.object.rotation.y=Math.round(this.object.rotation.y/o)*o),"Z"===this.axis&&o&&(this.object.rotation.z=Math.round(this.object.rotation.z/o)*o)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),J.copy(this.object.position),N.copy(this.object.quaternion),B.copy(this.object.scale),this.object.matrixWorld.decompose(F,O,C),X.copy(t.point).sub(F)}this.dragging=!0,w.mode=this.mode,this.dispatchEvent(w)}},this.pointerMove=function(e){var t=this.axis,n=this.mode,object=this.object,o=this.space;if("scale"===n?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==object&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){v.setFromCamera(e,this.camera);var l=S(r,v,!0);if(l){if(Y.copy(l.point).sub(F),"translate"===n)Z.copy(Y).sub(X),"local"===o&&"XYZ"!==t&&Z.applyQuaternion(_),-1===t.indexOf("X")&&(Z.x=0),-1===t.indexOf("Y")&&(Z.y=0),-1===t.indexOf("Z")&&(Z.z=0),"local"===o&&"XYZ"!==t?Z.applyQuaternion(N).divide(W):Z.applyQuaternion(k).divide(W),object.position.copy(Z).add(J),this.translationSnap&&("local"===o&&(object.position.applyQuaternion(x.copy(N).inverse()),-1!==t.search("X")&&(object.position.x=Math.round(object.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(object.position.y=Math.round(object.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(object.position.z=Math.round(object.position.z/this.translationSnap)*this.translationSnap),object.position.applyQuaternion(N)),"world"===o&&(object.parent&&object.position.add(M.setFromMatrixPosition(object.parent.matrixWorld)),-1!==t.search("X")&&(object.position.x=Math.round(object.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(object.position.y=Math.round(object.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(object.position.z=Math.round(object.position.z/this.translationSnap)*this.translationSnap),object.parent&&object.position.sub(M.setFromMatrixPosition(object.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var c=Y.length()/X.length();Y.dot(X)<0&&(c*=-1),f.set(c,c,c)}else M.copy(X),f.copy(Y),M.applyQuaternion(_),f.applyQuaternion(_),f.divide(M),-1===t.search("X")&&(f.x=1),-1===t.search("Y")&&(f.y=1),-1===t.search("Z")&&(f.z=1);object.scale.copy(B).multiply(f),this.scaleSnap&&(-1!==t.search("X")&&(object.scale.x=Math.round(object.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(object.scale.y=Math.round(object.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(object.scale.z=Math.round(object.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){Z.copy(Y).sub(X);var h=20/R.distanceTo(M.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(E.copy(U),D=Y.angleTo(X),L.copy(X).normalize(),I.copy(Y).normalize(),D*=I.cross(L).dot(U)<0?1:-1):"XYZE"===t?(E.copy(Z).cross(U).normalize(),D=Z.dot(M.copy(E).cross(this.eye))*h):"X"!==t&&"Y"!==t&&"Z"!==t||(E.copy(P[t]),M.copy(P[t]),"local"===o&&M.applyQuaternion(G),D=Z.dot(M.cross(U).normalize())*h),this.rotationSnap&&(D=Math.round(D/this.rotationSnap)*this.rotationSnap),this.rotationAngle=D,"local"===o&&"E"!==t&&"XYZE"!==t?(object.quaternion.copy(N),object.quaternion.multiply(x.setFromAxisAngle(E,D)).normalize()):(E.applyQuaternion(k),object.quaternion.copy(x.setFromAxisAngle(E,D)),object.quaternion.multiply(N).normalize())}this.dispatchEvent(d),this.dispatchEvent(y)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(m.mode=this.mode,this.dispatchEvent(m)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return h.mode},this.setMode=function(e){h.mode=e},this.setTranslationSnap=function(e){h.translationSnap=e},this.setRotationSnap=function(e){h.rotationSnap=e},this.setScaleSnap=function(e){h.scaleSnap=e},this.setSize=function(e){h.size=e},this.setSpace=function(e){h.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};r.prototype=Object.assign(Object.create(o.cb.prototype),{constructor:r,isTransformControls:!0});var l=function(){o.cb.call(this),this.type="TransformControlsGizmo";var e=new o.T({depthTest:!1,depthWrite:!1,transparent:!0,side:o.o,fog:!1}),t=new o.E({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),n=e.clone();n.opacity=.15;var r=e.clone();r.opacity=.33;var l=e.clone();l.color.set(16711680);var c=e.clone();c.color.set(65280);var h=e.clone();h.color.set(255);var d=e.clone();d.opacity=.25;var w=d.clone();w.color.set(16776960);var m=d.clone();m.color.set(65535);var y=d.clone();y.color.set(16711935),e.clone().color.set(16776960);var v=t.clone();v.color.set(16711680);var S=t.clone();S.color.set(65280);var M=t.clone();M.color.set(255);var f=t.clone();f.color.set(65535);var x=t.clone();x.color.set(16711935);var P=t.clone();P.color.set(16776960);var X=t.clone();X.color.set(7895160);var Y=P.clone();Y.opacity=.25;var Z=new o.l(0,.05,.2,12,1,!1),E=new o.f(.125,.125,.125),L=new o.i;L.setAttribute("position",new o.s([0,0,0,1,0,0],3));var I,D=function(e,t){for(var n=new o.i,r=[],i=0;i<=64*t;++i)r.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return n.setAttribute("position",new o.s(r,3)),n},Q={X:[[new o.S(Z,l),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new o.S(Z,l),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new o.D(L,v)]],Y:[[new o.S(Z,c),[0,1,0],null,null,"fwd"],[new o.S(Z,c),[0,1,0],[Math.PI,0,0],null,"bwd"],[new o.D(L,S),null,[0,0,Math.PI/2]]],Z:[[new o.S(Z,h),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new o.S(Z,h),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new o.D(L,M),null,[0,-Math.PI/2,0]]],XYZ:[[new o.S(new o.db(.1,0),d.clone()),[0,0,0],[0,0,0]]],XY:[[new o.S(new o.hb(.295,.295),w.clone()),[.15,.15,0]],[new o.D(L,P),[.18,.3,0],null,[.125,1,1]],[new o.D(L,P),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o.S(new o.hb(.295,.295),m.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new o.D(L,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new o.D(L,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o.S(new o.hb(.295,.295),y.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new o.D(L,x),[.18,0,.3],null,[.125,1,1]],[new o.D(L,x),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},z={X:[[new o.S(new o.l(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new o.S(new o.l(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new o.S(new o.l(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new o.S(new o.db(.2,0),n)]],XY:[[new o.S(new o.hb(.4,.4),n),[.2,.2,0]]],YZ:[[new o.S(new o.hb(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new o.S(new o.hb(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},j={START:[[new o.S(new o.db(.01,2),r),null,null,null,"helper"]],END:[[new o.S(new o.db(.01,2),r),null,null,null,"helper"]],DELTA:[[new o.D((I=new o.i,I.setAttribute("position",new o.s([0,0,0,1,1,1],3)),I),r),null,null,null,"helper"]],X:[[new o.D(L,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o.D(L,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o.D(L,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},T={X:[[new o.D(D(1,.5),v)],[new o.S(new o.db(.04,0),l),[0,0,.99],null,[1,3,1]]],Y:[[new o.D(D(1,.5),S),null,[0,0,-Math.PI/2]],[new o.S(new o.db(.04,0),c),[0,0,.99],null,[3,1,1]]],Z:[[new o.D(D(1,.5),M),null,[0,Math.PI/2,0]],[new o.S(new o.db(.04,0),h),[.99,0,0],null,[1,3,1]]],E:[[new o.D(D(1.25,1),Y),null,[0,Math.PI/2,0]],[new o.S(new o.l(.03,0,.15,4,1,!1),Y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new o.S(new o.l(.03,0,.15,4,1,!1),Y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new o.S(new o.l(.03,0,.15,4,1,!1),Y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new o.S(new o.l(.03,0,.15,4,1,!1),Y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new o.D(D(1,1),X),null,[0,Math.PI/2,0]]]},A={AXIS:[[new o.D(L,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},k={X:[[new o.S(new o.Gb(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new o.S(new o.Gb(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new o.S(new o.Gb(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new o.S(new o.Gb(1.25,.1,2,24),n)]],XYZE:[[new o.S(new o.Ab(.7,10,8),n)]]},W={X:[[new o.S(E,l),[.8,0,0],[0,0,-Math.PI/2]],[new o.D(L,v),null,null,[.8,1,1]]],Y:[[new o.S(E,c),[0,.8,0]],[new o.D(L,S),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new o.S(E,h),[0,0,.8],[Math.PI/2,0,0]],[new o.D(L,M),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new o.S(E,w),[.85,.85,0],null,[2,2,.2]],[new o.D(L,P),[.855,.98,0],null,[.125,1,1]],[new o.D(L,P),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o.S(E,m),[0,.85,.85],null,[.2,2,2]],[new o.D(L,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new o.D(L,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o.S(E,y),[.85,0,.85],null,[2,.2,2]],[new o.D(L,x),[.855,0,.98],null,[.125,1,1]],[new o.D(L,x),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new o.S(new o.f(.125,.125,.125),d.clone()),[1.1,0,0]]],XYZY:[[new o.S(new o.f(.125,.125,.125),d.clone()),[0,1.1,0]]],XYZZ:[[new o.S(new o.f(.125,.125,.125),d.clone()),[0,0,1.1]]]},F={X:[[new o.S(new o.l(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new o.S(new o.l(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new o.S(new o.l(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new o.S(E,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new o.S(E,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new o.S(E,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new o.S(new o.f(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new o.S(new o.f(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new o.S(new o.f(.2,.2,.2),n),[0,0,1.1]]]},O={X:[[new o.D(L,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o.D(L,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o.D(L,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C=function(e){var t=new o.cb;for(var n in e)for(var i=e[n].length;i--;){var object=e[n][i][0].clone(),r=e[n][i][1],l=e[n][i][2],c=e[n][i][3],h=e[n][i][4];object.name=n,object.tag=h,r&&object.position.set(r[0],r[1],r[2]),l&&object.rotation.set(l[0],l[1],l[2]),c&&object.scale.set(c[0],c[1],c[2]),object.updateMatrix();var d=object.geometry.clone();d.applyMatrix4(object.matrix),object.geometry=d,object.renderOrder=1/0,object.position.set(0,0,0),object.rotation.set(0,0,0),object.scale.set(1,1,1),t.add(object)}return t},R=new o.Lb(0,0,0),G=new o.p,_=new o.Lb(0,1,0),H=new o.Lb(0,0,0),U=new o.R,J=new o.nb,N=new o.nb,B=new o.nb,K=new o.Lb(1,0,0),V=new o.Lb(0,1,0),$=new o.Lb(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(Q)),this.add(this.gizmo.rotate=C(T)),this.add(this.gizmo.scale=C(W)),this.add(this.picker.translate=C(z)),this.add(this.picker.rotate=C(k)),this.add(this.picker.scale=C(F)),this.add(this.helper.translate=C(j)),this.add(this.helper.rotate=C(A)),this.add(this.helper.scale=C(O)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:B;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var n=[];n=(n=(n=n.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var i=0;i<n.length;i++){var r,l=n[i];if(l.visible=!0,l.rotation.set(0,0,0),l.position.copy(this.worldPosition),r=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),l.scale.set(1,1,1).multiplyScalar(r*this.size/7),"helper"!==l.tag){if(l.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==l.name&&"XYZX"!==l.name||Math.abs(_.copy(K).applyQuaternion(t).dot(this.eye))>.99&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),"Y"!==l.name&&"XYZY"!==l.name||Math.abs(_.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),"Z"!==l.name&&"XYZZ"!==l.name||Math.abs(_.copy($).applyQuaternion(t).dot(this.eye))>.99&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),"XY"===l.name&&Math.abs(_.copy($).applyQuaternion(t).dot(this.eye))<.2&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),"YZ"===l.name&&Math.abs(_.copy(K).applyQuaternion(t).dot(this.eye))<.2&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),"XZ"===l.name&&Math.abs(_.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),-1!==l.name.search("X")&&(_.copy(K).applyQuaternion(t).dot(this.eye)<0?"fwd"===l.tag?l.visible=!1:l.scale.x*=-1:"bwd"===l.tag&&(l.visible=!1)),-1!==l.name.search("Y")&&(_.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===l.tag?l.visible=!1:l.scale.y*=-1:"bwd"===l.tag&&(l.visible=!1)),-1!==l.name.search("Z")&&(_.copy($).applyQuaternion(t).dot(this.eye)<0?"fwd"===l.tag?l.visible=!1:l.scale.z*=-1:"bwd"===l.tag&&(l.visible=!1))}else"rotate"===this.mode&&(N.copy(t),_.copy(this.eye).applyQuaternion(J.copy(t).inverse()),-1!==l.name.search("E")&&l.quaternion.setFromRotationMatrix(U.lookAt(this.eye,H,V)),"X"===l.name&&(J.setFromAxisAngle(K,Math.atan2(-_.y,_.z)),J.multiplyQuaternions(N,J),l.quaternion.copy(J)),"Y"===l.name&&(J.setFromAxisAngle(V,Math.atan2(_.x,_.z)),J.multiplyQuaternions(N,J),l.quaternion.copy(J)),"Z"===l.name&&(J.setFromAxisAngle($,Math.atan2(_.y,_.x)),J.multiplyQuaternions(N,J),l.quaternion.copy(J)));l.visible=l.visible&&(-1===l.name.indexOf("X")||this.showX),l.visible=l.visible&&(-1===l.name.indexOf("Y")||this.showY),l.visible=l.visible&&(-1===l.name.indexOf("Z")||this.showZ),l.visible=l.visible&&(-1===l.name.indexOf("E")||this.showX&&this.showY&&this.showZ),l.material._opacity=l.material._opacity||l.material.opacity,l.material._color=l.material._color||l.material.color.clone(),l.material.color.copy(l.material._color),l.material.opacity=l.material._opacity,this.enabled?this.axis&&(l.name===this.axis||this.axis.split("").some((function(a){return l.name===a}))?(l.material.opacity=1,l.material.color.lerp(new o.k(1,1,1),.5)):(l.material.opacity*=.25,l.material.color.lerp(new o.k(1,1,1),.5))):(l.material.opacity*=.5,l.material.color.lerp(new o.k(1,1,1),.5))}else l.visible=!1,"AXIS"===l.name?(l.position.copy(this.worldPositionStart),l.visible=!!this.axis,"X"===this.axis&&(J.setFromEuler(G.set(0,0,0)),l.quaternion.copy(t).multiply(J),Math.abs(_.copy(K).applyQuaternion(t).dot(this.eye))>.9&&(l.visible=!1)),"Y"===this.axis&&(J.setFromEuler(G.set(0,0,Math.PI/2)),l.quaternion.copy(t).multiply(J),Math.abs(_.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(l.visible=!1)),"Z"===this.axis&&(J.setFromEuler(G.set(0,Math.PI/2,0)),l.quaternion.copy(t).multiply(J),Math.abs(_.copy($).applyQuaternion(t).dot(this.eye))>.9&&(l.visible=!1)),"XYZE"===this.axis&&(J.setFromEuler(G.set(0,Math.PI/2,0)),_.copy(this.rotationAxis),l.quaternion.setFromRotationMatrix(U.lookAt(H,_,V)),l.quaternion.multiply(J),l.visible=this.dragging),"E"===this.axis&&(l.visible=!1)):"START"===l.name?(l.position.copy(this.worldPositionStart),l.visible=this.dragging):"END"===l.name?(l.position.copy(this.worldPosition),l.visible=this.dragging):"DELTA"===l.name?(l.position.copy(this.worldPositionStart),l.quaternion.copy(this.worldQuaternionStart),R.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),R.applyQuaternion(this.worldQuaternionStart.clone().inverse()),l.scale.copy(R),l.visible=this.dragging):(l.quaternion.copy(t),this.dragging?l.position.copy(this.worldPositionStart):l.position.copy(this.worldPosition),this.axis&&(l.visible=-1!==this.axis.search(l.name)))}o.cb.prototype.updateMatrixWorld.call(this)}};l.prototype=Object.assign(Object.create(o.cb.prototype),{constructor:l,isTransformControlsGizmo:!0});var c=function(){o.S.call(this,new o.hb(1e5,1e5,2,2),new o.T({visible:!1,wireframe:!0,side:o.o,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new o.Lb(1,0,0),t=new o.Lb(0,1,0),n=new o.Lb(0,0,1),r=new o.Lb,l=new o.Lb,c=new o.Lb,h=new o.R,d=new o.nb;this.updateMatrixWorld=function(){var w=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(w="local"),e.set(1,0,0).applyQuaternion("local"===w?this.worldQuaternion:d),t.set(0,1,0).applyQuaternion("local"===w?this.worldQuaternion:d),n.set(0,0,1).applyQuaternion("local"===w?this.worldQuaternion:d),c.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":c.copy(this.eye).cross(e),l.copy(e).cross(c);break;case"Y":c.copy(this.eye).cross(t),l.copy(t).cross(c);break;case"Z":c.copy(this.eye).cross(n),l.copy(n).cross(c);break;case"XY":l.copy(n);break;case"YZ":l.copy(e);break;case"XZ":c.copy(n),l.copy(t);break;case"XYZ":case"E":l.set(0,0,0)}break;case"rotate":default:l.set(0,0,0)}0===l.length()?this.quaternion.copy(this.cameraQuaternion):(h.lookAt(r.set(0,0,0),l,c),this.quaternion.setFromRotationMatrix(h)),o.cb.prototype.updateMatrixWorld.call(this)}};c.prototype=Object.assign(Object.create(o.S.prototype),{constructor:c,isTransformControlsPlane:!0})}}]);